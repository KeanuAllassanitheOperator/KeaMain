# sysctl.conf â€“ Optimized for general-purpose Rocky Linux VMs (small to heavy workloads)
# Focused on networking, memory, and performance tuning with SELinux enabled

# --- Network Performance Tweaks ---
net.ipv4.ip_forward = 1                         # Enable IP forwarding for routing/NAT
net.ipv4.ip_nonlocal_bind = 1                   # Allow binding to non-local IPs (useful for HA/load balancing)
net.ipv4.tcp_fin_timeout = 15                   # Faster cleanup of closed TCP connections
net.ipv4.tcp_tw_reuse = 1                       # Reuse TIME-WAIT sockets for new connections
net.ipv4.tcp_max_syn_backlog = 4096             # Increase SYN backlog to handle more concurrent connections
net.core.somaxconn = 4096                       # Max incoming connections backlog
net.core.netdev_max_backlog = 5000              # Queue limit for incoming packets
net.ipv4.tcp_syncookies = 1                     # Enable SYN cookies to protect against SYN flood attacks

# --- TCP Memory Management ---
net.core.rmem_max = 16777216                    # Max read buffer size
net.core.wmem_max = 16777216                    # Max write buffer size
net.ipv4.tcp_rmem = 4096 87380 16777216         # Min/default/max TCP read buffer
net.ipv4.tcp_wmem = 4096 65536 16777216         # Min/default/max TCP write buffer
net.ipv4.tcp_mtu_probing = 1                    # Enable MTU probing to avoid fragmentation

# --- TCP Advanced ---
net.ipv4.tcp_window_scaling = 1                 # Enable TCP window scaling
net.ipv4.tcp_timestamps = 1                     # Improve TCP performance with accurate RTT
net.ipv4.tcp_sack = 1                           # Enable Selective Acknowledgements for better performance

# --- Virtual Memory Tuning ---
vm.max_map_count = 262144                       # Required for many modern apps (e.g., Elasticsearch)
vm.swappiness = 10                              # Prefer to keep processes in RAM, swap only when needed
vm.vfs_cache_pressure = 50                      # Balance inode/dentry cache retention
vm.dirty_background_ratio = 5                   # Background flush threshold
vm.dirty_ratio = 10                             # Max dirty pages before blocking writes

# --- Security-Related (SELinux remains enabled via default config) ---
kernel.randomize_va_space = 2                   # Enable full address space layout randomization (ASLR)
