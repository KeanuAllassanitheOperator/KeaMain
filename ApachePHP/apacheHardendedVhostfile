ServerRoot "/etc/httpd"

Listen 80
Listen 443

Include conf.modules.d/*.conf

User apache
Group apache

ServerAdmin root@localhost

<Directory />
    AllowOverride none
    Require all denied
</Directory>

DocumentRoot "xxxxx"

<Directory "/var/www">
    AllowOverride None
    Require all granted
</Directory>

<Directory "xxxxxxx">
    Options FollowSymLinks
    AllowOverride All
    Require all granted
</Directory>

<IfModule dir_module>
    DirectoryIndex index.html index.php
</IfModule>

<FilesMatch "^\.ht">
    Require all denied
</FilesMatch>

ErrorLog "logs/error_log"
LogLevel warn

<IfModule log_config_module>
    LogFormat "%h %l %u %t \"%r\" %>s %b \"%{Referer}i\" \"%{User-Agent}i\"" combined
    LogFormat "%h %l %u %t \"%r\" %>s %b" common
    CustomLog "logs/access_log" combined
</IfModule>

<IfModule alias_module>
    ScriptAlias /cgi-bin/ "/var/www/cgi-bin/"
</IfModule>

<Directory "/var/www/cgi-bin">
    AllowOverride None
    Options None
    Require all granted
</Directory>

<IfModule mime_module>
    TypesConfig /etc/mime.types
    AddType application/x-compress .Z
    AddType application/x-gzip .gz .tgz
    AddType text/html .shtml
    AddOutputFilter INCLUDES .shtml
</IfModule>

AddDefaultCharset UTF-8

EnableSendfile on

IncludeOptional conf.d/*.conf

# Sicherheitseinstellungen
FileETag None
ServerTokens Prod
ServerSignature Off
TraceEnable Off

<IfModule mod_headers.c>
    Header always set Strict-Transport-Security "max-age=63072000; includeSubDomains; preload"
    Header always set X-Frame-Options "SAMEORIGIN"
    Header always set X-XSS-Protection "1; mode=block"
    Header set X-Content-Type-Options "nosniff"
    Header set Referrer-Policy "no-referrer-when-downgrade"
    Header set Content-Security-Policy "default-src 'self';"
    Header set Permissions-Policy "geolocation=(), microphone=(), camera=()"
    Header always set Cache-Control "no-store, no-cache, must-revalidate, private"
    Header unset ETag
    Header edit Set-Cookie ^(.*)$ $1;HttpOnly;Secure
</IfModule>

<IfModule mod_ssl.c>
    SSLHonorCipherOrder On
    SSLProtocol -all +TLSv1.2 +TLSv1.3
    SSLCipherSuite HIGH:!aNULL:!MD5:!RC4:!3DES
    SSLCompression Off
    SSLSessionTickets Off
    SSLPassPhraseDialog exec:/usr/libexec/httpd-ssl-pass-dialog
    SSLSessionCache shmcb:/run/httpd/sslcache(512000)
    SSLSessionCacheTimeout 300
    SSLRandomSeed startup file:/dev/urandom 512
    SSLRandomSeed connect builtin
    SSLCryptoDevice builtin
</IfModule>

<VirtualHost *:80>
    ServerName xxxxx

     <LocationMatch "/(data|conf|bin|inc|vendor)/">
            Order allow,deny
            Deny from all
            Satisfy All
     </LocationMatch>
    #Redirect permanent /xxxxxx
</VirtualHost>

<VirtualHost *:443>
    ServerName xxxxx
    DocumentRoot "xxxxx"

    <Directory "xxxxxx">
        Options FollowSymLinks
        AllowOverride All
        Require all granted
    </Directory>
    <LocationMatch "/(data|conf|bin|inc|vendor)/">
            Order allow,deny
            Deny from all
            Satisfy All
    </LocationMatch>

    SSLEngine On
    SSLCertificateFile /etc/ssl/certs/wildcard.rzhartmann.de/certificate.pem
    SSLCertificateKeyFile /etc/ssl/certs/wildcard.rzhartmann.de/server_rsa.key
    SSLCACertificateFile /etc/ssl/certs/wildcard.rzhartmann.de/intermediate_ca.cer

    ErrorLog logs/ssl_error_log
    TransferLog logs/ssl_access_log
    CustomLog logs/ssl_request_log ssl_combined
</VirtualHost>